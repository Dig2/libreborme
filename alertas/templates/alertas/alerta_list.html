{% extends "alertas/base_dashboard.html" %}
{% load staticfiles %}
{% load bootstrap %}

{% block content %}

        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
          <h1 class="page-header">Listado de Alertas</h1>

          <p>Aquí puede definir sus alertas de LibreBORME. A continuación se detallan los límites asociados a su tipo de cuenta:</p>

          <div class="col-sm-3">
            <table class="table">
              <thead>
                <tr>
                  <th>Tipo de alerta</th>
                  <th>Alertas máximas</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>Personas</td>
                  <td>{{ limite_p }}</td>
                </tr>
                <tr>
                  <td>Empresas</td>
                  <td>{{ limite_c }}</td>
                </tr>
                <tr>
                  <td>Acto</td>
                  <td>{{ limite_a }}</td>
                </tr>
              </tbody>
            </table>
          </div>
          <div class="row placeholders">

          </div>

          <h2 class="sub-header">Alertas de empresas (restantes: {{ restantes_c }})</h2>
          <div class="table-responsive">
            {% if restantes_c > 0 %}
            <a href="#" data-toggle="modal" data-target="#alerta-company-modal">Añadir nueva alerta</a>
            {% endif %}

            {% if alertas_c %}
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Empresa</th>
                  <th>Enviar HTML</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
            {% for alerta in alertas_c %}
                <tr>
                  <td>{{ forloop.counter }}</td>
                  <td><a target="_blank" href="{% url 'borme-empresa' alerta.company.name|slug2 %}">{{ alerta.company }}</a></td>
                  <td>{% if alerta.send_html %}
                    <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                    {% else %}
                    <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                    {% endif %}
                  </td>
                  <td>
                    <a href="{% url 'alerta-remove-company' alerta.id %}">
                    <button type="button" class="btn btn-primary btn-xs">
                      <span class="glyphicon glyphicon-trash" aria-hidden="true"></span> Eliminar
                    </button>
                    </a>
                  </td>
                </tr>
            {% endfor %}
              </tbody>
            </table>
            {% endif %}

          </div>


          <h2 class="sub-header">Alertas de personas (restantes: {{ restantes_p }})</h2>
          <div class="table-responsive">
            {% if restantes_p > 0 %}
            <a href="#" data-toggle="modal" data-target="#alerta-person-modal">Añadir nueva alerta</a>
            {% endif %}
            {% if alertas_p %}
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Persona</th>
                  <th>Enviar HTML</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
            {% for alerta in alertas_p %}
                <tr>
                  <td>{{ forloop.counter }}</td>
                  <td><a target="_blank" href="{% url 'borme-persona' alerta.person.name|slug %}">{{ alerta.person }}</a></td>
                  <td>{% if alerta.send_html %}
                    <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                    {% else %}
                    <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                    {% endif %}
                  </td>
                  <td>
                    <a href="{% url 'alerta-remove-person' alerta.id %}">
                    <button type="button" class="btn btn-primary btn-xs">
                      <span class="glyphicon glyphicon-trash" aria-hidden="true"></span> Eliminar
                    </button>
                    </a>
                  </td>
                </tr>
            {% endfor %}
              </tbody>
            </table>
            {% endif %}

          </div>


          <h2 class="sub-header">Alertas de actos mercantiles (restantes: {{ restantes_a }})</h2>
          <div class="table-responsive">
            {% if restantes_a > 0 %}
            <a href="#" data-toggle="modal" data-target="#alerta-acto-modal">Añadir nueva alerta</a>
            {% endif %}
            {% if alertas_a %}
            <table class="table table-striped">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Tipo de evento</th>
                  <th>Provincia</th>
                  <th>Periodicidad</th>
                  <th>Enviar HTML</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody>
            {% for alerta in alertas_a %}
                <tr>
                  <td>{{ forloop.counter }}</td>
                  <td>{{ alerta.get_evento_display }}</td>
                  <td>{{ alerta.get_provincia_display }}</td>
                  <td>{{ alerta.get_periodicidad_display }}</td>
                  <td>{% if alerta.send_html %}
                    <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                    {% else %}
                    <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                    {% endif %}
                  </td>
                  <td>
                    {% comment %}
                    <button type="button" class="btn btn-primary btn-xs">
                      <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span> Editar
                    </button>
                    {% endcomment %}
                    <a href="{% url 'alerta-remove-acto' alerta.id %}">
                    <button type="button" class="btn btn-primary btn-xs">
                      <span class="glyphicon glyphicon-trash" aria-hidden="true"></span> Eliminar
                    </button>
                    </a>
                  </td>
                </tr>
            {% endfor %}

              </tbody>
            </table>
            {% endif %}
          </div>

          <h2 class="sub-header">Suscripción TEST</h2>
          {% include 'stripe_form.html' %}

        </div>


<div class="modal fade" id="alerta-person-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="loginmodal-container">
      <form action="{% url "alertas-new-person" %}" role="form" method="post">
        <legend>Añadir una nueva Alerta</legend>
          {% csrf_token %}
          {{ form_p|bootstrap }}
          <div class="form-group">
            <input type="submit" name="create" class="login loginmodal-submit" value="Crear">
          </div>
      </form>
    </div>
  </div>
</div>

<div class="modal fade" id="alerta-company-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="loginmodal-container">
      <form action="{% url "alertas-new-company" %}" role="form" method="post">
        <legend>Añadir una nueva Alerta</legend>
          {% csrf_token %}
          {{ form_c|bootstrap }}
          <div class="form-group">
            <input type="submit" name="create" class="login loginmodal-submit" value="Crear">
          </div>
      </form>
    </div>
  </div>
</div>

<div class="modal fade" id="alerta-acto-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="loginmodal-container">
      <form action="{% url "alertas-new-acto" %}" role="form" method="post">
        <legend>Añadir una nueva Alerta</legend>
          {% csrf_token %}
          {{ form_a|bootstrap }}
          <div class="form-group">
            <input type="submit" name="create" class="login loginmodal-submit" value="Crear">
          </div>
      </form>
    </div>
  </div>
</div>


{% endblock %}

{% block extrastyles %}
    <link href="{% static "css/dashboard_form.css" %}" rel="stylesheet">
    <link href="{% static "jquery-ui-1.12.1.custom/jquery-ui.css" %}" rel="stylesheet" >
{% endblock %}

{% block extrajs %}
    <script src="{% static "jquery-ui-1.12.1.custom/jquery-ui.js" %}"></script>
    <script src="{% static "alertas.js" %}"></script>
{% endblock %}
