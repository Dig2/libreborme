{% extends "alertas/base.html" %}
{% load bootstrap %}
{% load compress %}
{% load staticfiles %}

{% block title %}Panel de alertas | LibreBORME{% endblock %}

{% comment %}
css

    <div class="form-group row">
        <label for="inputProvince" class="col-sm-3 col-form-label">Provincia</label>
        <div class="col-sm-9">
            <select class="custom-select my-1 mr-sm-2" id="inlineFormCustomSelectPref">
                <option selected>Provincia</option>
                <option value="1">One</option>
                <option value="2">Two</option>
                <option value="3">Three</option>
            </select>
        </div>
    </div>
{% endcomment %}

{% block extrastyles %}
{% compress css %}
    <link rel="stylesheet" type="text/x-scss" href="{% static 'assets/css/panel.scss' %}">
{% endcompress %}
{% endblock %}

{% block content %}
<main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags }}" role="alert">{{ message }}</div>
    {% endfor %}

    <section style="padding: 20px 0;">
        <div class="row">
            <div class="col-md-12">
                <h1 class="title-section">
                    <span>|</span>Mi perfil
                </h1>
            </div>
        </div>
        <div class="row mt-3">
            <div class="col-md-12">
                <h3 class="subtitle-panel">Servicios contratados</h3>

          {% if customer.has_any_active_subscription %}
            <p>Tiene las siguientes suscripciones activas</p>

            <div class="row">
            <div class="col-sm-8">
            <div class="table-responsive">
              <table class="table table-striped">
                <thead>
                  <tr>
                    <th>Suscripción</th>
                    <th>Comienzo</th>
                    <th>Final del período</th>
                    <th>Estado</th>
                    <th>Período de prueba</th>
                    <th>Acciones</th>
                  </tr>
                </thead>
                <tbody>
                  {% for subscription in customer.subscriptions.all %}
                  <tr>
                    <td>{{ subscription.plan.product.name }}</td>
                    <td>{{ subscription.start.date }}</td>
                    <td>{{ subscription.current_period_end.date }}</td>
                    <td>
                      {% if subscription.status == 'trialing' %}
                      <span class="badge badge-warning">Periodo de prueba</span>
                      {% elif subscription.status == 'active' %}
                      <span class="badge badge-success">Activo</span>
                      {% else %}
                      <span class="badge badge-danger">{{ subscription.status }}</span>
                      {% endif %}
                    </td>
                    <td>{% if subscription.trial_end %}
                            Hasta el {{ subscription.trial_end.date }}
                        {% else %}
                            <i class="fas fa-times"></i>
                        {% endif %}</td>
                    <td>
                      {% if subscription.cancel_at_period_end %}
                      Cancelada el {{ subscription.canceled_at.date }}
                      {% else %}
                        <a href="#">
                        <button type="button" class="btn btn-primary btn-xs">
                          <i class="fas fa-trash-alt"></i> Cancelar
                        </button>
                        </a>
                      {% endif %}
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            </div>
            </div>

          {% else %}
            <p class="description mt-4">No tienes ningún servicio contratado actualmente.</p>
            <p class="description">Sin embargo, puedes probar el servicio de <a href="{% url 'service-follow' %}">Seguimiento</a> de forma gratuita.</p>
            <p class="description">Puedes obtener más información sobre los servicios disponibles <a href="#">Aquí (TODO)</a></p>
          {% endif %}
            </div>
        </div>
    </section>
    <section>
        <div class="row">
            <div class="col-md-12">
                <h1 class="title-section">
                    <span>|</span>Mi perfil
                </h1>
            </div>
        </div>
        <div class="row mt-3">
            <div class="col-md-6 mt-4 pr-5">
                <h3 class="subtitle-panel">Datos Personales</h3>
                <form class="mt-4" action="{% url "old-alertas-settings-billing" %}" role="form" method="post">
                    {% csrf_token %}
                    {{ form_personal|bootstrap_horizontal }}
                </form>

                <a class="change-pass" href="{% url 'password_change' %}">Cambiar contraseña</a>

            </div>
            <div class="col-md-6 mt-4 pr-5">
                <h3 class="subtitle-panel">Datos de Facturación</h3>
                <form class="mt-4">
                    {% csrf_token %}
                    {{ form_profile|bootstrap_horizontal }}
                </form>
            </div>

            <div class="col-md-6 col-legal">
                <h3 class="subtitle-panel mt-4">Boletín</h3>

                <form class="mt-4">
                    {{ form_newsletter|bootstrap_horizontal }}
                </form>
                <div class="row mt-5">
                    <div class="col-md-12">
                        <a class="btn btn2 btn-primary2 btn-transparent" href="#" role="button">Actualizar</a>
                    </div>
                    <div class="col-md-12 mt-5">
                        <a class="" href="#" role="button"><i class="far fa-trash-alt"></i> Cerrar mi cuenta</a>
                    </div>
                </div>
            </div>
        </div>
    </section>
</main>
{% endblock %}
