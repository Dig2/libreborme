{% extends "borme/base2.html" %}
{% comment %}
- related desformateado
- link sale azul


{% block extrajs %}
  <script src="{% static "js/libreborme.js" %}"></script>
  <script src="{% static "static_jquery/js/jquery.min.js" %}"></script>
{% endblock %}

{% endcomment %}

{% load actos %}
{% load compress %}
{% load staticfiles %}
{% load utils %}

{% block title %}{{ company.fullname }} | LibreBORME{% endblock %}

{% block meta %}
  <meta name="keywords" content="{{ company.fullname|upper }}, Empresas, Informe, CNAE, Registro, Mercantil, Actos, BOE, BORME, Open Data, Cargos, Directivos"/>
  <meta name="description" content="{{ company.fullname|upper }}. Información mercantil de la empresa {{ company.fullname|upper }}. Cargos directivos de {{ company.fullname|upper }}. Actos publicados en el BORME de {{ company.fullname|upper }}."/>
{% endblock %}

{% block extrastyles %}
{% compress css %}
    <link rel="stylesheet" type="text/x-scss" href="{% static 'assets/css/details.scss' %}">
{% endcompress %}
{% endblock %}

{% block extrajs %}
  <script src="{% static "follow.js" %}"></script>
  <script>
      $("#follow-button").click(function(ev) {

      var slug = $(ev.currentTarget).attr("data");
      var csrftoken = getCookie('csrftoken');
      configCsrf(csrftoken);

      $("#follow_spinner").toggle();

      $.ajax({
        method: "POST",
        url: "{% url 'borme-ajax-follow' %}",
        data: {slug: slug, type: 'company'}
      })
      .always(function(xhr, textStatus) {
        var resp = $.parseJSON(xhr);
        var alert_follow = $("#alert-follow");
        alert_follow.html(resp.html);
        alert_follow.attr("class", "col-md-2 alert alert-follow alert-" + resp.tag);
        alert_follow.show();
        $("#follow_spinner").toggle();

        if (typeof resp.following !== 'undefined') {
          if (resp.following) {
            var span = $("#follow-button")
                         .find("i")
                         .attr("class", "fas fa-eye-slash");
            $("#follow-button")
              .text(" Dejar de seguir")
              .prepend(span);
          } else {
            var span = $("#follow-button")
                         .find("i")
                         .attr("class", "fas fa-eye");
            $("#follow-button")
              .text(" Seguir")
              .prepend(span);
          }
        }
        alert_follow.fadeOut(5000);
      });

    });
  </script>
{% endblock %}

{% block content %}
<div class="view-details mt-4">
    <div class="section-title-result-details">
        <div class="container">
            <div class="row mt-4">
                <div class="col-md-12">
                    <ul class="list-inline list-unstyled mb-0">
                        <li class="list-inline-item">
                            <h1>{{ company.name|upper }}</h1>
                        </li>
                        <li class="list-inline-item">

                              <div>
                              <p>
                              <button id="follow-button" type="button" class="btn-secondary btn-details" data="{{ company.slug }}">
                                {% if is_following %}
                                  <i class="fas fa-eye-slash"></i> Dejar de seguir
                                {% else %}
                                  <i class="fas fa-eye"></i> Seguir
                                {% endif %}
                              </button>
                              </p>
                              <p>
                              <div id="alert-follow" style="display: none;" class="col-md-2 alert alert-follow" role="alert"></div>
                              </p>
                              </div>
                              <img id="follow_spinner" style="display: none" src="{% static 'reload2.gif' %}" width=22>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="line-tabs">
        <hr>
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-7 col-lg-6">
                    <ul class="nav nav-tabs" id="myTab" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab" aria-controls="home" aria-selected="true">Información</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="historic-tab" data-toggle="tab" href="#historic" role="tab" aria-controls="historic" aria-selected="false">Historial</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="related-tab" data-toggle="tab" href="#related" role="tab" aria-controls="related" aria-selected="false">Relacionados</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="background-result">
            <div class="container">
                <div class="row">
                    <div class="col-md-12">
                        <div class="tab-content mt-5 mb-5" id="myTabContent">
                            <div class="tab-pane fade show active " id="home" role="tabpanel" aria-labelledby="home-tab">
                                {% include 'borme/details/historic.html' %}
                            </div>
                            <div class="tab-pane fade" id="historic" role="tabpanel" aria-labelledby="historic-tab">
                                {% include 'borme/details/information.html' %}
                            </div>
                            <div class="tab-pane fade" id="related" role="tabpanel" aria-labelledby="related-tab">
                                {% include 'borme/details/related.html' %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% include 'borme/sections/slide-services.html' %}

</div>
{% endblock %}
