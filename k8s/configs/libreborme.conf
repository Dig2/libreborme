server {
    listen 80;

    # access_log /var/log/nginx/libreborme.access.log mtail;
    # error_log /var/log/nginx/libreborme.error.log;

    # set max upload size
    client_max_body_size 5M;

    # Blocked because these take too much time to load
    location /borme/empresa/caixabank/ {
        return 301 /empresa/not-available;
    }
    location /borme/empresa/banco-bilbao-vizcaya-argentaria/ {
        return 301 /empresa/not-available;
    }
    location /borme/empresa/banco-santander/ {
        return 301 /empresa/not-available;
    }
    location /borme/empresa/deloitte/ {
        return 301 /empresa/not-available;
    }

    # Enable gzip but do not remove ETag headers
    gzip on;
    gzip_vary on;
    gzip_comp_level 4;
    gzip_min_length 256;
    gzip_proxied expired no-cache no-store private no_last_modified no_etag auth;
    gzip_types application/atom+xml application/javascript application/json application/ld+json application/manifest+json application/rss+xml application/vnd.geo+json application/vnd.ms-fontobject application/x-font-ttf application/x-web-app-manifest+json application/xhtml+xml application/xml font/opentype image/bmp image/svg+xml image/x-icon text/cache-manifest text/css text/plain text/vcard text/vnd.rim.location.xloc text/vtt text/x-component text/x-cross-domain-policy;

    location / {
        # uwsgi_param HTTP_X_FORWARDED_PROTO https;
        if (-f /home/libreborme/libreborme-web/public_html/maintenance_on.html) {
            return 503;
        }

        # matomo
        if ( $remote_addr = "128.199.53.105" )
        {
            access_log off;
        }

        proxy_http_version 1.1;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $http_host;
        proxy_set_header X-Cluster-Client-Ip $remote_addr;
        proxy_pass http://127.0.0.1:8000;

    }

    # Error pages.
    error_page 503 /maintenance_on.html;
    location = /maintenance_on.html {
        root /home/libreborme/libreborme-web/public_html/;
    }

    location = /favicon.ico {
        log_not_found off;
        access_log off;
    }

    location /static/ {
        alias /opt/libreborme/static/;
        expires 1h;
        # expires @8h00m;

        # add_header Cache-Control "public, max-age=15778463";
        # add_header X-Content-Type-Options nosniff;
        # add_header X-XSS-Protection "1; mode=block";
        # add_header X-Robots-Tag none;
        # add_header X-Download-Options noopen;
        # add_header X-Permitted-Cross-Domain-Policies none;

        # Optional: Don't log access to assets
        access_log off;
    }

    # location ~* \.(js|css|png|jpg|jpeg|gif|ico)$ {
    #     expires max;
    #     log_not_found off;
    # }

    location ~ /\.ht {
        deny  all;
    }

}
